@model StudentSuccessPredictor.Models.JournalStudent

<form method="post">
    <input asp-for="Id" type="hidden" />

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">ПІБ</label>
            <input asp-for="FullName" class="form-control" />
            <span asp-validation-for="FullName" class="text-danger"></span>
        </div>

        <div class="col-md-4 mb-3">
            <label class="form-label">Дата народження</label>
            @{
                var today = DateTime.Today;
                var maxDob = today.AddYears(-10);   // мін. 10 років
                var minDob = today.AddYears(-120);  // макс. 120 років
            }
            <input asp-for="DateOfBirth"
                   type="date"
                   class="form-control"
                   id="dob"
                   min="@minDob.ToString("yyyy-MM-dd")"
                   max="@maxDob.ToString("yyyy-MM-dd")" />
            <div class="form-text">Повних років: <span id="ageYears">-</span></div>
            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
        </div>

        <div class="col-md-2 mb-3">
            <label class="form-label">Стать</label>
            <select asp-for="Sex" class="form-select">
                <option value="F">F</option>
                <option value="M">M</option>
            </select>
            <span asp-validation-for="Sex" class="text-danger"></span>
        </div>

        <div class="col-md-3 mb-3">
            <label class="form-label">Попередній бал (0–100)</label>
            <input asp-for="PriorScore" type="number" min="0" max="100" step="0.1" class="form-control" />
            <span asp-validation-for="PriorScore" class="text-danger"></span>
        </div>

        <div class="col-md-3 mb-3">
            <label class="form-label">Пропуски занять</label>
            <input asp-for="Absences" type="number" class="form-control" min="0" max="150" step="1" />
            <span asp-validation-for="Absences" class="text-danger"></span>
        </div>

        <div class="col-md-3 mb-3">
            <label class="form-label">Нездачі (0–3)</label>
            <input asp-for="Failures" type="number" class="form-control" min="0" max="3" step="1" />
            <span asp-validation-for="Failures" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-3">
            <label class="form-label">Додатково</label>

            <div class="border rounded p-2">
                <div class="form-check">
                    <input asp-for="Higher" class="form-check-input" type="checkbox" />
                    <label class="form-check-label" asp-for="Higher">Бажає вищу освіту</label>
                </div>

                <div class="form-check mt-2">
                    <input asp-for="Tutoring" class="form-check-input" type="checkbox" />
                    <label class="form-check-label" asp-for="Tutoring">Є репетитори</label>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-3">
            <label class="form-label">Професія матері</label>
            <select asp-for="MotherJob" class="form-select">
                <option value="teacher">teacher</option>
                <option value="health">health</option>
                <option value="services">services</option>
                <option value="at_home">at_home</option>
                <option value="other">other</option>
            </select>
            <span asp-validation-for="MotherJob" class="text-danger"></span>
        </div>

        <div class="col-md-6 mb-3">
            <label class="form-label">Професія батька</label>
            <select asp-for="FatherJob" class="form-select">
                <option value="teacher">teacher</option>
                <option value="health">health</option>
                <option value="services">services</option>
                <option value="at_home">at_home</option>
                <option value="other">other</option>
            </select>
            <span asp-validation-for="FatherJob" class="text-danger"></span>
        </div>
    </div>

    <div class="d-flex gap-2">
        <button class="btn btn-primary" type="submit">Зберегти</button>
        <a class="btn btn-secondary" asp-action="Index">Назад</a>
    </div>
</form>

@section Scripts {
<script>
  function calcAgeYears(dobStr) {
    if (!dobStr) return null;
    const dob = new Date(dobStr);
    const today = new Date();
    let age = today.getFullYear() - dob.getFullYear();
    const m = today.getMonth() - dob.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
    return Math.max(0, age);
  }

  function updateAge() {
    const dob = document.getElementById('dob')?.value;
    const age = calcAgeYears(dob);
    const span = document.getElementById('ageYears');
    if (span) span.textContent = (age === null) ? "-" : age;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const dobEl = document.getElementById('dob');
    const form = dobEl?.closest('form');
    if (!dobEl || !form) return;

    dobEl.addEventListener('change', updateAge);
    updateAge();

    form.addEventListener('submit', (e) => {
      const age = calcAgeYears(dobEl.value);
      if (age === null) return;

      if (age > 75) {
        const ok = confirm(`Вік студента: ${age} років. Ви впевнені, що дату народження введено правильно?`);
        if (!ok) e.preventDefault();
      }
    });
  });
</script>
}
